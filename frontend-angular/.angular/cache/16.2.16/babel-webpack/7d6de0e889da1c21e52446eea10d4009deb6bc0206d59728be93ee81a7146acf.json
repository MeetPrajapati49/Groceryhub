{"ast":null,"code":"import { BehaviorSubject } from 'rxjs';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../core/api.service\";\nimport * as i2 from \"../core/auth.service\";\nimport * as i3 from \"@angular/router\";\nexport let CartService = /*#__PURE__*/(() => {\n  class CartService {\n    constructor(api, authService, router) {\n      this.api = api;\n      this.authService = authService;\n      this.router = router;\n      this.itemsSubject = new BehaviorSubject([]);\n      this.items$ = this.itemsSubject.asObservable();\n      this.load();\n      // Clear any old localStorage guest cart items\n      localStorage.removeItem('cart');\n    }\n    // Return a synchronous snapshot of current cart items\n    getSnapshot() {\n      return this.itemsSubject.value;\n    }\n    load() {\n      this.api.get('/cart').subscribe({\n        next: res => this.itemsSubject.next(res?.items || []),\n        error: () => {\n          const local = JSON.parse(localStorage.getItem('cart') || '[]');\n          this.itemsSubject.next(local);\n        }\n      });\n    }\n    add(product, quantity = 1) {\n      // optimistic update\n      const items = [...this.itemsSubject.value];\n      const idx = items.findIndex(i => i.product?._id === product._id || i.product === product);\n      if (idx >= 0) items[idx].quantity += quantity;else items.push({\n        product,\n        quantity\n      });\n      this.itemsSubject.next(items);\n      localStorage.setItem('cart', JSON.stringify(items));\n      this.api.post('/cart/add', {\n        productId: product._id,\n        quantity\n      }).subscribe({\n        error: () => this.load()\n      });\n    }\n    update(productId, quantity) {\n      const items = this.itemsSubject.value.map(i => i.product?._id === productId ? {\n        ...i,\n        quantity\n      } : i);\n      this.itemsSubject.next(items);\n      localStorage.setItem('cart', JSON.stringify(items));\n      this.api.put('/cart/update', {\n        productId,\n        quantity\n      }).subscribe({\n        error: () => this.load()\n      });\n    }\n    remove(productId) {\n      const items = this.itemsSubject.value.filter(i => i.product?._id !== productId);\n      this.itemsSubject.next(items);\n      localStorage.setItem('cart', JSON.stringify(items));\n      this.api.post('/cart/remove', {\n        productId\n      }).subscribe({\n        error: () => this.load()\n      });\n    }\n    // Remove by item reference (or when product object is null after deletion)\n    removeItem(item) {\n      const items = this.itemsSubject.value.filter(i => i !== item);\n      this.itemsSubject.next(items);\n      localStorage.setItem('cart', JSON.stringify(items));\n    }\n    static {\n      this.ɵfac = function CartService_Factory(t) {\n        return new (t || CartService)(i0.ɵɵinject(i1.ApiService), i0.ɵɵinject(i2.AuthService), i0.ɵɵinject(i3.Router));\n      };\n    }\n    static {\n      this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n        token: CartService,\n        factory: CartService.ɵfac,\n        providedIn: 'root'\n      });\n    }\n  }\n  return CartService;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}